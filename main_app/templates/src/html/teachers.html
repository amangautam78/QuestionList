{% extends 'src/html/base.html' %}
{% load static %}
{% block content %}

  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/js/bootstrap-select.min.js"></script>



<style type="text/css">

.container1 {
  background: white;
  padding: 10px;
  color: black;
}

.bootstrap-select>select.bs-select-hidden, select.bs-select-hidden, select.selectpicker {
}

.bootstrap-select>select.bs-select-hidden, select.bs-select-hidden, select.selectpicker {
     display: inline-block !important; 
}

</style>


<div class="container-fluid">
  <header class="container">
  </header>
</div>

<!-- Button trigger modal -->


<!-- Modal -->


<div class="container container1" style="height: 76vh;width: 100%;">
  <div class="table-wrapper table-responsive">
    <div class="table-title">
      <div class="row">
        <div class="col-sm-6">
          <h4>Manage <b>Teachers</b></h4>
        </div>
        <div class="col-sm-6">
          <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">
  <i class="fas fa-plus"></i> <span>Add New Student</span>
</button>
        </div>
      </div>
    </div>
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Classes</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
      	{% for teacher in teacher_data %}
        <tr data-teacher-id="{{ teacher.teacher_id }}">
          <td class="name">{{teacher.name}}</td>
          <td class="email">{{teacher.email}}</td>
          <td class="mobile">{{teacher.mobile}}</td>

          <td class="batch">
            {% for class in teacher.classes %}
              {{class}}
            {% endfor %}
        </td>
          <td>
                <i class="fas fa-pencil-alt" onclick="openEditModal(this)"></i>

                <i class="fas fa-trash-alt" onclick="openDeleteModal(this)"></i>

          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>
</div>

<!-- Add Modal HTML -->
<div id="addEmployeeModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="addStudentForm">
        <div class="modal-header">
          <h4 class="modal-title">Add Teacher</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Name</label>
            <input type="text" class="form-control" name="name" required>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" class="form-control" name="email" required>
          </div>

          <div class="form-group">
            <label>Mobile</label>
            <input type="text" class="form-control" name="mobile" required>
          </div>
          <div class="form-group">
            <div class="container mt-5">
  <select class="form-control selectpicker" name="classes" multiple aria-label="Default select example" data-live-search="true">   {% for class in class_data %}
                  <option value="{{ class.class_id }}">{{ class.name }}</option>
            {% endfor %}
              <!-- Options will be dynamically populated by Select2 -->
     </select>
</div>
           

        </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">Add</button>
        </div>
      </form>
    </div>
  </div>
</div>
<div class="section bottom-0 text-center">
  <h1 style="font-size: 4vw;color: #e3e3e3da;">Qna Class</h1>
</div>




<!-- Delete Modal HTML -->





<script type="text/javascript">





  $(document).ready(function() {
    $('#addStudentForm').submit(function(event) {
      // Prevent the default form submission
      event.preventDefault();
      
      // Serialize the form data
      var formData = $(this).serialize();
      
      // Make the AJAX call
      $.ajax({
        type: 'POST',
        url: '/teachers/',
        data: formData,

        success: function(response) {
          // Handle the success response here
          // Optionally, you can close the modal
          $('#addEmployeeModal').modal('hide');
			window.location.href = '/teachers/';
          // Reload or update the student list on the page if needed
          // Example: window.location.reload();
        },
        error: function(xhr, status, error) {
          // Handle any errors here
          console.error(xhr.responseText);
        }
      });
    });
  });

function openEditModal(iconElement) {
    var row = $(iconElement).closest('tr');
    var teacher_id = row.data('teacher-id');

    window.location.href = '/edit-teacher/' + teacher_id;
    $.ajax({
        type: 'GET',
        url: '/get-teacher/' + teacher_id + '/',
        success: function(response) {
            // Remove any existing modal with the same ID
            $(`#editStudentModal-${teacher_id}`).remove();

// Sample data for classes (Replace with your actual data)
var classData = response.data.selected_class;

// Create a container div for the select element
var selectContainer = document.createElement("div");
selectContainer.classList.add("container", "mt-5");

// Create the select element
var selectElement = document.createElement("select");
selectElement.classList.add("form-control", "selectpicker");
selectElement.setAttribute("name", "classes");
selectElement.setAttribute("multiple", "multiple");
selectElement.setAttribute("aria-label", "Default select example");
selectElement.setAttribute("data-live-search", "true");

// Append options to the select element
classData.forEach(function(classItem) {
  var option = document.createElement("option");
  option.value = classItem.class_id;
  option.textContent = classItem.name;
  selectElement.appendChild(option);
});

// Append the select element to the container div
selectContainer.appendChild(selectElement);

// Convert the container div to HTML string
var selectHtml = selectContainer.outerHTML;

// Insert the select HTML into your modal content
var modalContent = `
  <div id="editStudentModal-${teacher_id}" class="modal fade">
    <div class="modal-dialog">
      <div class="modal-content">
        <form class="editStudentForm" data-teacher-id="${teacher_id}">
          <div class="modal-header">
            <h4 class="modal-title">Edit Student</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>Name</label>
              <input type="text" class="form-control" name="name" value="${response.data.name}" required>
            </div>
            <div class="form-group">
              <label>Email</label>
              <input type="email" class="form-control" name="email" value="${response.data.email}" required>
            </div>
            <div class="form-group">
              <label>Mobile</label>
              <input type="text" class="form-control" name="mobile" value="${response.data.mobile}" required>
            </div>
            <div class="form-group">
              ${selectHtml}
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-info save-changes-btn" data-teacher-id="${teacher_id}">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>
`;

            $('body').append(modalContent);

            // Open the modal
            $(`#editStudentModal-${teacher_id}`).modal('show');

        },
        error: function(xhr, status, error) {
            // Handle error
            console.error(xhr.responseText);
        }
    });
}


$(document).on('click', '.save-changes-btn', function() {
  var teacher_id = $(this).data('teacher-id');
  saveChanges(teacher_id);
});


    function updateTableRow(teacher_id, newData) {
    	console.log(studentId, newData);

        var row = $(`tr[data-teacher-id="${teacher_id}"]`);
        row.find('.name').text(newData.name);
        row.find('.email').text(newData.email);
        row.find('.mobile').text(newData.mobile);
        row.find('.batch').text(newData.batch);
    }

function saveChanges(teacher_id) {

  var formData = $('.editStudentForm[data-teacher-id="' + teacher_id + '"]').serialize();
  formData += '&teacher_id=' + teacher_id;
  $.ajax({
    type: 'POST',
    url: '/teachers/',
    data: formData,
    success: function(response) {

      // Handle success response
      console.log(response);
      // Close the modal
      updateTableRow(teacher_id, response.data);
      $(`#editStudentModal-${teacher_id}`).modal('hide');

      
    },
    error: function(xhr, status, error) {
      // Handle error
      console.error(xhr.responseText);
    }
  });
}





function openDeleteModal(iconElement) {
    var row = $(iconElement).closest('tr');
    var teacher_id = row.data('teacher-id');


    var modalContent =`<div id="deleteStudentModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <form>
        <div class="modal-header">
          <h4 class="modal-title">Delete Student</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete these Records?</p>
          <p class="text-warning">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success delete-student" data-teacher-id="${teacher_id}">Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>`;
            $('body').append(modalContent);

            // Open the modal
            $(`#deleteStudentModal`).modal('show');

}

$(document).on('click', '.delete-student', function() {
  var teacher_id = $(this).data('teacher-id');

  // Make AJAX call to delete student
  $.ajax({
    type: 'DELETE',
    url: '/delete-teacher/' + teacher_id + '/',
    success: function(response) {
      // Remove the corresponding row from the table
      $('#deleteStudentModal').modal('hide');
      $(`#deleteStudentModal`).remove();
      $('tr[data-teacher-id="' + teacher_id + '"]').remove();
    },
    error: function(xhr, status, error) {
      console.error(xhr.responseText);
      // Handle error if needed
    }
  });
});



</script>

{% endblock %}
